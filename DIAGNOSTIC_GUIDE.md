# 🔧 دليل نظام التشخيص - حسام جم

## 📍 موقع أزرار التشخيص

### 1. **زر التشخيص الرئيسي** (أسفل يسار الشاشة)

- **الموقع**: ثابت في جميع الصفحات أسفل يسار الشاشة
- **الألوان**:
  - 🟢 **أخضر**: كل شيء يعمل بشكل طبيعي
  - 🟡 **أصفر**: تحذيرات (مثل تغييرات معلقة أو انقطاع إنترنت)
  - 🔴 **أحمر**: أخطاء في الاتصال أو قاعدة البيانات

### 2. **مؤشر الحالة السريع** (في شريط التنقل)

- **الموقع**: في الشريط الجانبي وشريط الموبايل العلوي
- **المعلومات**: حالة الاتصال والمزامنة

## 🔍 ما يفحصه النظام

### ✅ **فحوصات الاتصال**

1. **اتصال الإنترنت**: هل الجهاز متصل بالإنترنت؟
2. **اتصال Supabase**: هل يمكن الوصول لقاعدة البيانات؟
3. **سرعة الاستجابة**: قياس زمن الاستجابة من Supabase

### ✅ **فحوصات البيانات**

1. **التغييرات المعلقة**: كم تغيير لم يتم رفعه للسحابة؟
2. **البيانات المحلية**: كم سجل محفوظ في المتصفح؟
3. **تخزين المتصفح**: هل localStorage يعمل بشكل طبيعي؟

### ✅ **فحوصات قاعدة البيانات**

1. **الجداول المطلوبة**: تحقق من وجود جميع الجداول (9 جداول)
2. **الصلاحيات**: هل يمكن القراءة والكتابة؟
3. **البيانات الأساسية**: هل توجد أكواد دخول وبيانات تجريبية؟

### ✅ **فحوصات الأداء**

1. **استخدام الذاكرة**: مراقبة استهلاك ذاكرة التطبيق
2. **أداء التطبيق**: رصد البطء أو المشاكل

## 🚨 رسائل التحذير والأخطاء

### 🟡 **التحذيرات الشائعة**

#### "غير متصل بالإنترنت"

- **السبب**: انقطاع اتصال الإنترنت
- **التأثير**: العمل محلياً فقط، عدم مزامنة مع السحابة
- **الحل**: التحقق من اتصال الإنترنت

#### "X تغيير في انتظار المزامنة"

- **السبب**: توجد بيانات لم يتم رفعها للسحابة
- **التأثير**: البيانات محفوظة محلياً فقط
- **الحل**: انتظار عودة الاتصال أو الضغط على "إصلاح تلقائي"

#### "اتصال بطيء"

- **السبب**: استجابة Supabase أبطأ من 3 ثوان
- **التأثير**: بطء في حفظ البيانات
- **الحل**: التحقق من سرعة الإنترنت

### 🔴 **الأخطاء الشائعة**

#### "فشل الاتصال بقاعدة البيانات"

- **الأسباب المحتملة**:
  - مفاتيح Supabase خاطئة
  - مشروع Supabase غير نشط
  - مشاكل في إعدادات CORS
- **الحل**: مراجعة إعدادات Supabase

#### "الجدول X غير موجود"

- **السبب**: لم يتم تنفيذ سكربت قاعدة البيانات
- **الحل**: تنفيذ `database/schema.sql` في Supabase

#### "مشكلة في تخزين المتصفح"

- **الأسباب المحتملة**:
  - امتلاء مساحة localStorage
  - قيود الخصوصية في المتصفح
- **الحل**: مسح بيانات المتصفح أو استخدام وضع خاص

## 🔧 أزرار الإصلاح

### **زر "إصلاح تلقائي"**

- **متى يظهر**: عند وجود مشاكل قابلة للإصلاح
- **ما يفعله**:
  - مزامنة التغييرات المعلقة
  - إعادة تشغيل اتصال Supabase
  - تنظيف التخزين المحلي

### **زر "إعادة الفحص"**

- **الوظيفة**: تشغيل فحص شامل جديد
- **متى تستخدمه**: بعد إصلاح مشكلة أو تغيير إعدادات

## 📊 قراءة تقرير التشخيص

### **الألوان والرموز**

- ✅ **أخضر مع علامة صح**: كل شيء يعمل
- ⚠️ **أصفر مع تحذير**: مشكلة غير خطيرة
- ❌ **أحمر مع X**: خطأ يحتاج إصلاح

### **الإحصائيات السفلية**

```
نجح: 5    تحذير: 2    خطأ: 1
```

- **نجح**: عدد الفحوصات الناجحة
- **تحذير**: عدد التحذيرات
- **خطأ**: عدد الأخطاء الخطيرة

## 🔔 نظام الإشعارات التلقائية

### **إشعارات الاتصال**

- 🟢 "تم استعادة الاتصال بالإنترنت"
- 🔴 "انقطع الاتصال بالإنترنت"

### **إشعارات المزامنة**

- 🔄 "X تغيير في انتظار المزامنة"
- ✅ "تمت المزامنة بنجاح"
- ❌ "فشل في المزامنة"

### **إشعارات الأخطاء**

- ⚠️ "خطأ في قاعدة البيانات"

## 🛠️ للمطورين: استخدام النظام برمجياً

### **فحص سريع من Console**

```javascript
// فحص حالة Supabase
quickSupabaseCheck();

// عرض التغييرات المعلقة
console.log("تغييرات معلقة:", db.getPendingChangesCount());

// مزامنة يدوية
await db.syncAllToSupabase();
```

### **مراقبة الأحداث**

```javascript
// مراقبة تغيير حالة الاتصال
window.addEventListener("online", () => {
  console.log("عاد الاتصال");
});

window.addEventListener("offline", () => {
  console.log("انقطع الاتصال");
});
```

## 🎯 نصائح للاستكشاف والإصلاح

### **عند عدم ظهور البيانات**

1. اضغط زر التشخيص وتحقق من الأخطاء
2. تأكد من وجود اتصال إنترنت
3. تحقق من صحة مفاتيح Supabase
4. راجع Console للأخطاء

### **عند بطء التطبيق**

1. تحقق من "أداء التطبيق" في التشخيص
2. أعد تحميل الصفحة إذا كان استخدام الذاكرة >80%
3. تحقق من سرعة اتصال الإنترنت

### **عند مشاكل المزامنة**

1. تحقق من وجود تغييرات معلقة
2. استخدم "إصلاح تلقائي"
3. تحقق من حالة Supabase في Dashboard

## 📞 الحصول على المساعدة

### **معلومات للدعم التقني**

عند طلب المساعدة، قم بإرفاق:

1. **لقطة شاشة من تقرير التشخيص**
2. **رسائل الأخطاء من Console**
3. **إعدادات Supabase** (بدون المفاتيح السرية)
4. **خطوات إعادة إنتاج المشكلة**

### **فحص Log الكامل**

```javascript
// في Console المتصفح
console.log("=== تقرير شامل للنظام ===");
console.log("اتصال الإنترنت:", navigator.onLine);
console.log("التغييرات المعلقة:", db.getPendingChangesCount());
console.log("البيانات المحلية:", {
  مشتركين: db.getSubscribers().length,
  منتجات: db.getProducts().length,
  مبيعات: db.getSales().length,
});
```

---

**استخدم نظام التشخيص بانتظام للتأكد من سلامة عمل النظام! 🔧**
